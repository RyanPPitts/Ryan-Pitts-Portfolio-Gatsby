Object.defineProperty(exports, "__esModule", { value: true });
var graphql_1 = require("graphql");
var Interfaces_1 = require("../Interfaces");
var visitSchema_1 = require("../utils/visitSchema");
var clone_1 = require("../utils/clone");
function filterSchema(_a) {
    var _b;
    var schema = _a.schema, _c = _a.rootFieldFilter, rootFieldFilter = _c === void 0 ? function () { return true; } : _c, _d = _a.typeFilter, typeFilter = _d === void 0 ? function () { return true; } : _d, _e = _a.fieldFilter, fieldFilter = _e === void 0 ? function () { return true; } : _e;
    var filteredSchema = visitSchema_1.visitSchema(clone_1.cloneSchema(schema), (_b = {},
        _b[Interfaces_1.VisitSchemaKind.QUERY] = function (type) {
            return filterRootFields(type, 'Query', rootFieldFilter);
        },
        _b[Interfaces_1.VisitSchemaKind.MUTATION] = function (type) {
            return filterRootFields(type, 'Mutation', rootFieldFilter);
        },
        _b[Interfaces_1.VisitSchemaKind.SUBSCRIPTION] = function (type) {
            return filterRootFields(type, 'Subscription', rootFieldFilter);
        },
        _b[Interfaces_1.VisitSchemaKind.OBJECT_TYPE] = function (type) {
            return (typeFilter(type.name, type)) ?
                filterObjectFields(type, fieldFilter) :
                null;
        },
        _b[Interfaces_1.VisitSchemaKind.INTERFACE_TYPE] = function (type) {
            return typeFilter(type.name, type) ? undefined : null;
        },
        _b[Interfaces_1.VisitSchemaKind.UNION_TYPE] = function (type) {
            return typeFilter(type.name, type) ? undefined : null;
        },
        _b[Interfaces_1.VisitSchemaKind.INPUT_OBJECT_TYPE] = function (type) {
            return typeFilter(type.name, type) ? undefined : null;
        },
        _b[Interfaces_1.VisitSchemaKind.ENUM_TYPE] = function (type) {
            return typeFilter(type.name, type) ? undefined : null;
        },
        _b[Interfaces_1.VisitSchemaKind.SCALAR_TYPE] = function (type) {
            return typeFilter(type.name, type) ? undefined : null;
        },
        _b));
    filteredSchema.transforms = schema.transforms;
    return filteredSchema;
}
exports.default = filterSchema;
function filterRootFields(type, operation, rootFieldFilter) {
    var config = type.toConfig();
    Object.keys(config.fields).forEach(function (fieldName) {
        if (!rootFieldFilter(operation, fieldName)) {
            delete config.fields[fieldName];
        }
    });
    return new graphql_1.GraphQLObjectType(config);
}
function filterObjectFields(type, fieldFilter) {
    var config = type.toConfig();
    Object.keys(config.fields).forEach(function (fieldName) {
        if (!fieldFilter(type.name, fieldName)) {
            delete config.fields[fieldName];
        }
    });
    return new graphql_1.GraphQLObjectType(config);
}
//# sourceMappingURL=filterSchema.js.map